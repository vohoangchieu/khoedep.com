var LastViewProducts=function(config){var self=this;var config=config||{};var STORAGE_KEY=config.storageKey||'HRVLastViewProducts';var STORAGE_TYPE=(config.forever||true)?localStorage:sessionStorage;var handles=JSON.parse(STORAGE_TYPE.getItem(STORAGE_KEY))||[];self.max=config.max||10;self.all=function(offset,limit){var saveHandles=JSON.parse(STORAGE_TYPE.getItem(STORAGE_KEY))||[];offset=offset||0;limit=limit||0;if(offset>=0&&limit>0){saveHandles=saveHandles.slice(offset,limit);return getProducts(saveHandles)}return getProducts(saveHandles)};self.count=function(){return handles.length};self.add=function(handle){if(self.count()>=self.max){return null}var offset=self.find(handle);var handleNotExist=offset==-1;if(handleNotExist){handles.unshift(handle);save();return handle}return null};self.get=function(handle){if(!self.exist(handle)){return null}return getProduct(handle)};self.find=function(handle){return handles.indexOf(handle)};self.exist=function(handle){return self.find(handle)!=-1};self.getByOffset=function(offset){var handle=handles[offset];return self.get(handle)};self.remove=function(handle){var offset=self.find(handle);if(self.exist(handle)){handles.splice(offset,1);save();return true}return false};self.clear=function(){handles=[];save();return true};function getProduct(handle){if(!handle){return null}var product=null;jQuery.ajax({type:'GET',url:'/products/'+handle+'.json',async:false,contentType:'application/json',success:function(data){product=data.product}});return product};function getProducts(handles){var products=[];var offset=0;while(offset<handles.length){var handle=handles[offset];var product=getProduct(handle);if(product){products.push(product)}offset++}return products};function save(){STORAGE_TYPE.setItem(STORAGE_KEY,JSON.stringify(handles))}}